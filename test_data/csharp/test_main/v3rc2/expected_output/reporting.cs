/*
 * This code has been automatically generated by aas-core-codegen.
 * Do NOT edit or append.
 */

using System.Collections.Generic;  // can't alias

using Aas = AasCore.Aas3;

namespace AasCore.Aas3
{
    /// <summary>
    /// Provide reporting for de/serialization and verification.
    /// </summary>
    public static class Reporting
    {
        /// <summary>
        /// Capture a path segment of a value in a model.
        /// </summary
        internal abstract class Segment {
            // Intentionally empty.
        }

        internal class NameSegment : Segment {
            internal readonly string Name;
            internal NameSegment(string name)
            {
                Name = name;
            }
        }

        internal class IndexSegment : Segment {
            internal readonly int Index;
            internal IndexSegment(int index)
            {
                Index = index;
            }
        }

        internal static System.Text.RegularExpressions.Regex VariableNameRe = (
            new  System.Text.RegularExpressions.Regex(
                @"^[a-zA-Z_][a-zA-Z_0-9]*$"));

        /// <summary>
        /// Generate a JSON Path based on the path segments.
        /// </summary>
        /// <remarks>
        /// See, for example, this page for more information on JSON path:
        /// https://support.smartbear.com/alertsite/docs/monitors/api/endpoint/jsonpath.html
        /// </remarks>
        internal static string GenerateJsonPath(
            ICollection<Segment> segments)
        {
            var parts = new List<string>(segments.Count);
            int i = 0;
            foreach(var segment in segments)
            {
                string? part = null;
                switch (segment)
                {
                    case NameSegment nameSegment:
                        if (VariableNameRe.IsMatch(nameSegment.Name))
                        {
                            part = (i == 0) ? nameSegment.Name : $".{nameSegment.Name}";
                        }
                        else
                        {
                            string escaped = nameSegment.Name
                                .Replace("\\", "\\\\")
                                .Replace("\"", "\\\"")
                                .Replace("\b", "\\b")
                                .Replace("\f", "\\f")
                                .Replace("\n", "\\n")
                                .Replace("\r", "\\r")
                                .Replace("\t", "\\t");
                            part = $"[\"{escaped}\"]";
                        }
                        break;
                    case IndexSegment indexSegment:
                        part = $"[{indexSegment.Index}]";
                        break;
                    default:
                        throw new System.InvalidOperationException(
                            $"Unexpected segment type: {segment.GetType()}");
                }
                parts.Add(part);
            }
            return string.Join("", parts);
        }

        /// <summary>
        /// Represent an error during the deserialization or the verification.
        /// </summary>
        internal class Error
        {
            internal LinkedList<Segment> PathSegments = new LinkedList<Segment>();
            internal readonly string Cause;
            internal Error(string cause)
            {
                Cause = cause;
            }
        }
    }  // public static class Reporting
}  // namespace AasCore.Aas3

/*
 * This code has been automatically generated by aas-core-codegen.
 * Do NOT edit or append.
 */
